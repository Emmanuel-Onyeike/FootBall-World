<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Football News Hub ⚽</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Customizing Tailwind for a deep, modern dark theme
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#070707', // Deeper Ultra Dark
                        'card-bg': '#171717', // Lighter for cards
                        'primary': '#4CAF50', // Classic Sports Green
                        'secondary': '#81C784', // Light green accent
                        'text-light': '#F0F0F0', // Near White
                        'text-muted': '#A0A0A0',
                        'action-red': '#EF4444',
                        'action-blue': '#3B82F6',
                        'action-yellow': '#FBBF24',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        .news-card {
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
            border-left: 5px solid transparent; /* Base for hover effect */
        }
        .news-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            border-color: #4CAF50; /* Primary color highlight on hover */
        }
        /* Scrollbar hiding styles */
        #scrollableNewsFeed::-webkit-scrollbar { display: none; }
        #scrollableNewsFeed { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Search Bar Animation */
        .search-bar-hidden {
            max-height: 0; opacity: 0; padding: 0 !important; margin: 0 !important;
            transition: max-height 0.4s ease-out, opacity 0.4s ease-out;
        }
        .search-bar-visible {
            max-height: 100px; opacity: 1;
            transition: max-height 0.4s ease-in, opacity 0.4s ease-in;
        }

        /* Action Button Styles */
        .interaction-btn {
            @apply p-2 rounded-full hover:bg-gray-800 transition duration-150 text-text-muted;
        }
        .liked { @apply text-action-red; }
        .saved { @apply text-action-yellow; }
    </style>
</head>

<body class="bg-dark-bg text-text-light min-h-screen flex flex-col antialiased">

    <header class="sticky top-0 z-40 bg-card-bg border-b border-gray-800 shadow-xl">
        <div class="p-4 max-w-3xl mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-extrabold tracking-wide text-primary">
                <i class="fas fa-futbol mr-2"></i> Football News Hub
            </h1>
            <button id="searchButton" class="text-xl text-text-muted hover:text-secondary transition" title="Toggle Search">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <div id="searchBar" class="search-bar-hidden px-4 pb-4 max-w-3xl mx-auto w-full">
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Search news by title or content..." 
                    class="w-full bg-dark-bg text-text-light p-3 pl-10 rounded-lg border border-gray-700 focus:ring-2 focus:ring-primary focus:border-primary transition duration-150"
                    oninput="filterNews()">
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
            </div>
        </div>
    </header>

    <div class="flex-grow max-w-3xl mx-auto w-full p-4 md:p-6 flex flex-col">

        <h2 class="text-2xl font-bold mb-4 text-text-light border-b border-gray-700 pb-2">Latest Updates</h2>
        
        <div id="scrollableNewsFeed" class="flex-grow overflow-y-auto space-y-6 pr-2">
            <main id="newsContainer" class="space-y-6">
                </main>

            <div id="emptyState" class="hidden text-center p-12 text-text-muted">
                <i class="fas fa-inbox text-5xl mb-4 text-gray-700"></i>
                <p class="text-lg">No news found. Be the first to post an update!</p>
            </div>
            
            <div id="noResults" class="hidden text-center p-12 text-text-muted">
                <i class="fas fa-exclamation-circle text-5xl mb-4 text-action-red"></i>
                <p class="text-lg">No results found for your search term.</p>
            </div>
        </div>
    </div>


    <button id="openModalBtn" title="Create New Post" 
        class="fixed bottom-8 right-8 bg-primary hover:bg-green-600 text-dark-bg w-16 h-16 rounded-full shadow-2xl transition duration-300 transform hover:scale-110 z-50">
        <i class="fas fa-plus text-3xl"></i>
    </button>

    <div id="modalBg" class="hidden fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50">
        <div id="postModalContent" class="bg-card-bg p-6 md:p-8 rounded-2xl shadow-2xl w-11/12 max-w-lg border border-gray-700">
            <h2 class="text-2xl font-bold mb-6 text-center text-secondary">
                <i class="fas fa-feather-alt mr-2"></i> Create News Post
            </h2>
            <div id="imagePreviewContainer" class="hidden mb-4 rounded-lg overflow-hidden border-2 border-primary/50">
                <img id="imagePreview" src="" alt="Image Preview" class="w-full h-40 object-cover" />
            </div>
            <label for="postImage" class="block mb-2 font-semibold text-text-muted">Upload Image (Optional)</label>
            <input id="postImage" type="file" accept="image/*" class="w-full mb-4 text-text-light file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/20 file:text-primary hover:file:bg-primary/30 rounded-lg p-2 transition cursor-pointer border border-gray-700" />
            <label for="postText" class="block mb-2 font-semibold text-text-muted">Write Up *</label>
            <textarea id="postText" placeholder="What's the latest scoop?" 
                class="w-full h-32 bg-dark-bg text-text-light p-4 rounded-lg border border-gray-700 focus:ring-2 focus:ring-primary focus:border-primary transition resize-none"></textarea>
            <div class="flex justify-between mt-6">
                <button id="closeModalBtn" class="bg-gray-700 text-white font-semibold px-6 py-2 rounded-full hover:bg-gray-600 transition duration-150">
                    Cancel
                </button>
                <button id="postBtn" class="bg-primary text-dark-bg font-bold px-6 py-2 rounded-full hover:bg-green-600 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-paper-plane mr-2"></i> Post
                </button>
            </div>
        </div>
    </div>
    
    <div id="commentModalBg" class="hidden fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50">
        <div id="commentModalContent" class="bg-card-bg p-6 md:p-8 rounded-2xl shadow-2xl w-11/12 max-w-lg border border-gray-700">
            <h2 class="text-2xl font-bold mb-6 text-center text-secondary">
                <i class="fas fa-comments mr-2"></i> Add a Comment
            </h2>
            <textarea id="commentText" placeholder="Share your thoughts..." 
                class="w-full h-24 bg-dark-bg text-text-light p-4 rounded-lg border border-gray-700 focus:ring-2 focus:ring-primary focus:border-primary transition resize-none"></textarea>
            <div class="flex justify-between mt-6">
                <button id="closeCommentModalBtn" class="bg-gray-700 text-white font-semibold px-6 py-2 rounded-full hover:bg-gray-600 transition duration-150">
                    Cancel
                </button>
                <button id="submitCommentBtn" class="bg-primary text-dark-bg font-bold px-6 py-2 rounded-full hover:bg-green-600 transition duration-150">
                    <i class="fas fa-check mr-2"></i> Submit Comment
                </button>
            </div>
        </div>
    </div>

<script>
    // --- Configuration ---
    const API_KEY = "7286dd2e13720bdc15b0a24407265cd113acaf74c8f2990f9a68e3a3c9f86363"; 
    const CACHE_KEY = "footballNewsCache";
    const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

    // --- UI Elements ---
    const searchButton = document.getElementById("searchButton");
    const searchBar = document.getElementById("searchBar");
    const searchInput = document.getElementById("searchInput");
    const openModalBtn = document.getElementById("openModalBtn");
    const modalBg = document.getElementById("modalBg");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const postBtn = document.getElementById("postBtn");
    const newsContainer = document.getElementById("newsContainer");
    const postImage = document.getElementById("postImage");
    const postText = document.getElementById("postText");
    const imagePreview = document.getElementById("imagePreview");
    const imagePreviewContainer = document.getElementById("imagePreviewContainer");
    const emptyState = document.getElementById("emptyState");
    const noResults = document.getElementById("noResults");
    const commentModalBg = document.getElementById("commentModalBg");
    
    let allNewsCards = []; // Store all card elements for filtering

    // Utility to format date in a readable way (e.g., "3 hours ago")
    const timeSince = (date) => {
        const seconds = Math.floor((new Date() - date) / 1000);
        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + " years ago";
        interval = seconds / 2592000;
        if (interval > 1) return Math.floor(interval) + " months ago";
        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + " days ago";
        interval = seconds / 3600;
        if (interval > 1) return Math.floor(interval) + " hours ago";
        interval = seconds / 60;
        if (interval > 1) return Math.floor(interval) + " minutes ago";
        return "Just now";
    };

    // --- Interaction Functions ---
    
    // 1. LIKE BUTTON FUNCTION (FIXED)
    window.handleLike = (postId, buttonElement) => {
        const card = document.getElementById(`post-${postId}`);
        if (!card) return;

        let currentLikes = parseInt(card.dataset.likes || 0);
        const likeCounter = card.querySelector('.like-count');
        
        if (buttonElement.classList.toggle('liked')) {
            currentLikes++;
            buttonElement.querySelector('i').classList.replace('far', 'fas');
            console.log(`Liked post ${postId}. New count: ${currentLikes}`);
        } else {
            currentLikes--;
            buttonElement.querySelector('i').classList.replace('fas', 'far');
            console.log(`Unliked post ${postId}. New count: ${currentLikes}`);
        }

        card.dataset.likes = currentLikes;
        likeCounter.textContent = currentLikes > 0 ? currentLikes : '';
    };

    // 2. SAVE BUTTON FUNCTION (FIXED)
    window.handleSave = (postId, buttonElement) => {
        buttonElement.classList.toggle('saved');
        const isSaved = buttonElement.classList.contains('saved');
        buttonElement.title = isSaved ? 'Unsave Post' : 'Save Post';
        buttonElement.querySelector('i').classList.toggle('far');
        buttonElement.querySelector('i').classList.toggle('fas');

        console.log(`Post ${postId} is now ${isSaved ? 'SAVED' : 'UNSAVED'} on the site.`);
    };

    // 3. DOWNLOAD BUTTON FUNCTION (UPDATED to simulate download)
    window.handleDownload = (postId) => {
        const card = document.getElementById(`post-${postId}`);
        const img = card.querySelector('img');

        if (img && img.src) {
            const imageUrl = img.src;
            // Create a temporary anchor element
            const a = document.createElement('a');
            a.href = imageUrl;
            // Set filename. This usually only works for same-origin URLs or data URLs.
            a.download = `news_post_${postId}.jpg`; 
            
            // Append to body, click it, and remove it
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            console.log(`Download simulated for post ${postId}. Image URL: ${imageUrl}`);
            alert(`Download initiated for image from post ${postId}. Check your downloads.`);
        } else {
            alert("No image available to download for this post.");
        }
    };

    // 4. COMMENT MODAL OPENER (FIXED)
    window.openCommentModal = (postId) => {
        commentModalBg.classList.remove("hidden");
        commentModalBg.dataset.postId = postId; 
        document.getElementById("commentText").value = ''; 
    };
    
    // --- Modal Closing (Enhanced) ---
    function closeModal(modalElement) {
        modalElement.classList.add("hidden");
    }
    
    // Close Post Modal logic
    modalBg.addEventListener('click', (e) => {
        if (e.target === modalBg) {
            closeModal(modalBg);
        }
    });
    document.getElementById("closeModalBtn").addEventListener("click", () => {
        closeModal(modalBg);
    });

    // Close Comment Modal logic
    commentModalBg.addEventListener('click', (e) => {
        if (e.target === commentModalBg) {
            closeModal(commentModalBg);
        }
    });
    document.getElementById("closeCommentModalBtn").addEventListener("click", () => {
        closeModal(commentModalBg);
    });

    document.getElementById("submitCommentBtn").addEventListener("click", () => {
        const postId = commentModalBg.dataset.postId;
        const comment = document.getElementById("commentText").value.trim();
        
        if (comment) {
            console.log(`SUBMITTED COMMENT for Post ID ${postId}: "${comment}"`);
            alert(`Comment submitted for Post ID ${postId}. (Saved locally, not persistent)`);
            closeModal(commentModalBg);
        } else {
            alert("Please enter a comment.");
        }
    });

    // --- Post Form Logic (FIXED: Post Button Enable) ---
    openModalBtn.addEventListener("click", () => {
        modalBg.classList.remove("hidden");
        // Reset form content when opening
        postImage.value = "";
        postText.value = "";
        imagePreviewContainer.classList.add("hidden");
        postBtn.disabled = true;
    });

    function togglePostButton() {
        const filePresent = postImage.files.length > 0;
        const textPresent = postText.value.trim().length > 0;
        postBtn.disabled = !(filePresent || textPresent);
    }

    postImage.addEventListener("change", togglePostButton);
    postText.addEventListener("input", togglePostButton);


    // Remaining Post Image Preview Logic
    postImage.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreviewContainer.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
        } else {
            imagePreview.src = "";
            imagePreviewContainer.classList.add("hidden");
        }
    });

    // Post Submission Logic (Unchanged, uses createNewsCard)
    postBtn.addEventListener("click", () => {
        const file = postImage.files[0];
        const text = postText.value.trim();
        if (!file && !text) return;
        
        const postId = crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).substring(2, 9);
        const reader = new FileReader();

        reader.onloadend = () => {
            const imgSrc = file ? reader.result : null;
            const postDate = new Date();

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = createNewsCard({ 
                id: postId,
                title: "User Post", 
                body: text, 
                imageUrl: imgSrc, 
                date: postDate,
                likes: 0 
            }, false);
            const newCard = tempDiv.firstChild;

            newsContainer.insertAdjacentElement("afterbegin", newCard);
            allNewsCards.unshift(newCard); 

            closeModal(modalBg);
            emptyState.classList.add("hidden");
            filterNews(); 
        };

        if (file) reader.readAsDataURL(file);
        else reader.onloadend(); 
    });


    // --- News Card Builder (Unchanged) ---
    function createNewsCard(item, isApi = true) {
        const postId = item.id || crypto.randomUUID(); 
        const initialLikes = item.likes || 0;
        const postDate = item.date instanceof Date ? item.date : new Date(item.date); 
        
        const sourceIcon = isApi 
            ? '<i class="fas fa-globe text-xl text-action-red mr-2"></i>'
            : '<i class="fas fa-user-circle text-xl text-secondary mr-2"></i>';
        
        const cardClass = isApi 
            ? 'border-gray-700' 
            : 'border-2 border-secondary/70 shadow-secondary/20';

        const titleColor = isApi ? 'text-primary' : 'text-secondary';
        
        const imageHtml = item.imageUrl 
            ? `<img src="${item.imageUrl}" alt="${item.title}" class="w-full h-48 object-cover rounded-xl mb-4 shadow-lg" />`
            : '';
        
        return `
            <div id="post-${postId}" class="news-card bg-card-bg p-5 rounded-2xl shadow-xl ${cardClass} transition duration-300" data-likes="${initialLikes}" data-date="${postDate.toISOString()}">
                ${imageHtml}
                <div class="flex items-center mb-3">
                    ${sourceIcon}
                    <span class="text-sm font-semibold text-text-muted">${isApi ? 'API News Feed' : 'Your Post'}</span>
                </div>
                <h3 class="text-xl font-extrabold mb-2 ${titleColor}">${item.title}</h3>
                <p class="text-text-light text-base leading-relaxed whitespace-pre-line">${item.body}</p>
                <div class="mt-4 flex justify-between items-center border-t border-gray-800 pt-3">
                    <span class="text-xs text-gray-500"><i class="far fa-calendar-alt mr-1"></i> ${timeSince(postDate)}</span>
                    
                    <div class="flex items-center space-x-1 text-text-muted">
                        <div class="flex items-center space-x-1">
                            <button onclick="handleLike('${postId}', this)" title="Like Post" class="interaction-btn hover:text-action-red">
                                <i class="far fa-heart"></i>
                            </button>
                            <span class="like-count text-xs">${initialLikes > 0 ? initialLikes : ''}</span>
                        </div>

                        <button onclick="openCommentModal('${postId}')" title="Comment" class="interaction-btn hover:text-action-blue"><i class="far fa-comment-dots"></i></button>
                        <button onclick="handleDownload('${postId}')" title="Download Image" class="interaction-btn hover:text-primary"><i class="fas fa-download"></i></button>
                        <button onclick="handleSave('${postId}', this)" title="Save Post" class="interaction-btn hover:text-action-yellow"><i class="far fa-bookmark"></i></button>
                    </div>
                </div>
            </div>
        `;
    }

    // --- Data Loading and Initialization (UPDATED MOCK DATA) ---
    function loadNews() {
        console.log("Loading news using API Key:", API_KEY);
        
        // Dummy data with guaranteed images for testing
        const apiData = [
            { id: 'a1', title: "Man. City Star Faces Long Layoff After Injury", body: "Scans confirm a Grade 2 hamstring tear, sidelining the winger for up to two months, a major blow to their title defence.", imageUrl: "https://images.unsplash.com/photo-1543787361-9c6a71e2330e?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", date: new Date(Date.now() - 45 * 60 * 1000), likes: 12 },
            { id: 'b2', title: "Transfer Buzz: Bellingham to Liverpool Rumors Resurface", body: "Reports from Spain indicate a renewed interest from the Merseyside club as the summer window approaches. A €150M fee is being floated.", imageUrl: "https://images.unsplash.com/photo-1533083811807-6b47c0c29b6f?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", date: new Date(Date.now() - 3 * 60 * 60 * 1000), likes: 58 },
            { id: 'c3', title: "VAR Controversy Rages On", body: "An in-depth look at the latest major incidents and calls for clearer communication protocols.", imageUrl: "https://images.unsplash.com/photo-1579975775468-2c262174c35e?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", date: new Date(Date.now() - 24 * 60 * 60 * 1000), likes: 0 }, 
            { id: 'd4', title: "MLS Expansion Update: San Diego Announced as 30th Team", body: "The league confirms the new franchise will begin play in 2028 with a custom-built downtown stadium.", imageUrl: "https://images.unsplash.com/photo-1531671981881-807923f03b5f?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", date: new Date(Date.now() - 48 * 60 * 60 * 1000), likes: 23 },
        ];

        if (apiData && apiData.length > 0) {
            apiData.forEach(item => {
                const html = createNewsCard(item, true);
                newsContainer.insertAdjacentHTML("beforeend", html);
            });
            allNewsCards = Array.from(newsContainer.children);
            emptyState.classList.add("hidden");
        } else if (newsContainer.children.length === 0) {
            emptyState.classList.remove("hidden");
        }
    }

    // Load news immediately when the script is parsed
    loadNews();

    // --- Search Logic (Unchanged) ---
    searchButton.addEventListener("click", () => {
        searchBar.classList.toggle("search-bar-hidden");
        searchBar.classList.toggle("search-bar-visible");
        if (searchBar.classList.contains("search-bar-visible")) {
            searchInput.focus();
        } else {
            searchInput.value = '';
            filterNews(); 
        }
    });

    function filterNews() {
        const query = searchInput.value.toLowerCase().trim();
        let matches = 0;

        allNewsCards.forEach(card => {
            const title = card.querySelector('h3').textContent.toLowerCase();
            const body = card.querySelector('p').textContent.toLowerCase();

            if (title.includes(query) || body.includes(query)) {
                card.style.display = 'block';
                matches++;
            } else {
                card.style.display = 'none';
            }
        });

        if (query.length > 0 && matches === 0) {
            noResults.classList.remove("hidden");
        } else {
            noResults.classList.add("hidden");
        }
        
        if (allNewsCards.length > 0) {
            emptyState.classList.add("hidden");
        } else if (matches === 0 && query.length === 0) {
            emptyState.classList.remove("hidden");
        }
    }
</script>

</body>
</html>
