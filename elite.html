<!DOCTYPE html>
<html lang="en" class="transition-colors duration-500">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite League - Public Dashboard</title>
     <link rel="icon" type="image/svg+xml" href="MIKOKO .png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* light gray bg */
        }
        .dark body {
            background-color: #111827; /* dark gray bg */
        }
        .dark .bg-white {
            background-color: #1f2937;
        }
        /* Custom Dark Blue Theme */
        .elite-blue {
            background-color: #3b82f6; /* blue-500 */
        }
        .news-item {
            border-left: 4px solid #60a5fa; /* blue-400 */
        }
        .dark .news-item {
            border-left: 4px solid #3b82f6; /* blue-500 */
        }

        /* Chat Specific Styling */
        #chatMessages {
            height: 400px;
            max-height: 70vh;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 1rem;
        }
        .message-bubble {
            max-width: 85%;
            word-wrap: break-word;
        }
        #chatMessages::-webkit-scrollbar { display: none; }
        #chatMessages { -ms-overflow-style: none; scrollbar-width: none; }
        .chat-icon-button { transition: color 0.2s, transform 0.1s; }
        .chat-icon-button:hover { transform: scale(1.1); }
        .chat-icon-button:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 font-sans min-h-screen transition-colors duration-500">

    <div id="usernameModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md m-4">
            <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-4">Join the Chat!</h2>
            <p class="text-gray-700 dark:text-gray-300 mb-6">Enter a name to start sending messages.</p>
            <input 
                type="text" 
                id="chatUserNameInput" 
                placeholder="Your Chat Name" 
                class="w-full p-3 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
                maxlength="20"
            >
            <button 
                id="saveUserNameButton"
                class="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-300 shadow-md mt-4"
            >
                Start Chatting
            </button>
        </div>
    </div>

    <nav class="bg-white dark:bg-gray-800 shadow-md transition-colors duration-500">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <span class="text-2xl font-extrabold text-blue-600 dark:text-blue-400">ELITE LEAGUE</span>
            <a href="#" id="authStatusIndicator" class="text-sm text-gray-700 dark:text-gray-300 hover:text-blue-500 dark:hover:text-blue-300 transition duration-300 p-2 rounded-full">
                Authenticating...
            </a>
        </div>
    </nav>
    
    <main class="container mx-auto px-4 py-8 space-y-12">
<section class="p-6 md:p-10 rounded-xl shadow-2xl elite-blue text-white text-center flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-6">

    <!-- IMAGE LOGO -->
    <img 
        src="ELITE.png" 
        alt="League Logo" 
        class="w-24 h-24 md:w-32 md:h-32 rounded-full object-cover shadow-lg border-4 border-white"
    />

    <div>
        <h1 class="text-3xl sm:text-4xl font-black uppercase tracking-wider text-white">
            Elite League Standings and Dashboard
        </h1>
        <p class="text-xl font-medium text-blue-100 mt-2">
            Official results, stats, and updates for the Elite League.
        </p>
    </div>

</section>


        <section class="space-y-6">
            <h2 class="text-3xl font-extrabold text-gray-900 dark:text-gray-100 border-b-2 border-blue-500 dark:border-blue-400 pb-3">
                üì∞ Latest Elite League News
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="newsContainer">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md news-item transition duration-300 hover:shadow-lg hover:border-blue-700 dark:hover:border-blue-300">
                    <p class="text-sm font-semibold text-blue-600 dark:text-blue-400">LEAGUE UPDATE</p>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mt-1">Elite League Kicks Off with New Teams</h3>
                    <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">The expanded Elite League featuring CSC, MSS, and LAW departments is officially underway!.</p>
                    <span class="text-xs text-gray-500 dark:text-gray-400 mt-2 block">Just Now</span>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md news-item transition duration-300 hover:shadow-lg hover:border-blue-700 dark:hover:border-blue-300">
                    <p class="text-sm font-semibold text-blue-600 dark:text-blue-400">FIXTURE ALERT</p>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mt-1">First Round Matches Confirmed</h3>
                    <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">Check the Fixtures section for the full schedule of the opening round games this weekend.</p>
                    <span class="text-xs text-gray-500 dark:text-gray-400 mt-2 block">Today</span>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md news-item transition duration-300 hover:shadow-lg hover:border-blue-700 dark:hover:border-blue-300">
                    <p class="text-sm font-semibold text-blue-600 dark:text-blue-400">RULES</p>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mt-1">Transfer Window Closes Soon</h3>
                    <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">Administrators are finalizing rosters. No more players can be assigned after the deadline.</p>
                    <span class="text-xs text-gray-500 dark:text-gray-400 mt-2 block">This Week</span>
                </div>
            </div>
        </section>

        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 space-y-8">
                
                <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg transition-colors duration-500 border-t-4 border-blue-500 dark:border-blue-600">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6 border-b pb-3 border-blue-400 dark:border-blue-600">
                        üèÜ Official League Standings
                    </h2>
                    
                    <div class="overflow-x-auto"> 
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700"> 
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">#</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">Team</th>
                                    <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">P</th>
                                    <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">W</th>
                                    <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">D</th>
                                    <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">L</th>
                                    <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">Pts</th>
                                </tr>
                            </thead>
                            <tbody id="leagueTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"> 
                                <tr><td colspan="7" class="py-4 text-center text-gray-500 dark:text-gray-400">Loading standings...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <section class="p-6 rounded-xl bg-gray-900 dark:bg-gray-800 shadow-2xl border border-blue-700 transition-colors duration-500">
                    <h2 class="text-2xl font-extrabold text-blue-400 mb-6 flex items-center tracking-wide border-b border-blue-800 pb-3">
                        ‚öΩ Player Leaders
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        
                        <div>
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                                <i class="fas fa-bullseye text-yellow-400 mr-2"></i> Top Scorers
                            </h3>
                            <div id="scorersList" class="space-y-3 pr-2 max-h-80 overflow-y-auto">
                                <p class="text-gray-400 text-center italic">Loading scorers...</p>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                                <i class="fas fa-handshake text-green-400 mr-2"></i> Top Assists
                            </h3>
                            <div id="assistsList" class="space-y-3 pr-2 max-h-80 overflow-y-auto">
                                <p class="text-gray-400 text-center italic">Loading assists...</p>
                            </div>
                        </div>

                    </div>
                </section>
            </div>

            <div class="lg:col-span-1 space-y-8">
                
                <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg transition-colors duration-500 border-l-4 border-blue-500 dark:border-blue-600">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4">
                        üóìÔ∏è Match Fixtures & Results
                    </h2>
                    
                    <div id="fixtureListContainer" class="h-96 overflow-y-auto pr-2 space-y-4">
                        <p class="text-sm font-semibold text-gray-500 dark:text-gray-400">No matches scheduled yet.</p>
                    </div>
                </section>

                <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg transition-colors duration-500">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4 border-b pb-3 border-blue-400 dark:border-blue-600">
                        üìã Official League Roster
                    </h2>
                    
                    <div id="rosterList" class="h-64 overflow-y-auto space-y-3 text-sm text-gray-700 dark:text-gray-300 pr-2">
                        <p class="font-semibold text-gray-500 dark:text-gray-400">No players assigned yet.</p>
                    </div>
                </section>
                
            </div>
        </div>

        <section class="mt-12">
             <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden transition-colors duration-500 border-t-8 border-blue-600 dark:border-blue-500">
                
                <div class="p-4 bg-gray-100 dark:bg-gray-700 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">
                        üí¨ Elite League Live Chat
                    </h2>
                    <span id="chatUserIdDisplay" class="text-sm text-gray-500 dark:text-gray-400 font-mono italic"></span>
                </div>

                <div id="chatMessages" class="flex flex-col space-y-4">
                    <div class="text-center p-4 text-sm text-gray-500 dark:text-gray-400" id="chatLoadingMessage">
                        Connecting to chat...
                    </div>
                    </div>

                <div id="chatInputArea" class="p-3 border-t border-gray-200 dark:border-gray-700 flex items-center bg-gray-50 dark:bg-gray-800 sticky bottom-0 hidden">
                    
                    <button id="vnButton" class="chat-icon-button p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 focus:outline-none" title="Send Voice Note (Simulated)">
                        <i class="fas fa-microphone text-xl"></i>
                    </button>

                    <button id="stickerButton" class="chat-icon-button p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 focus:outline-none" title="Send Sticker (Simulated)">
                        <i class="far fa-smile text-xl"></i>
                    </button>

                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Type a message..." 
                        class="flex-grow mx-3 p-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-full text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
                        onkeypress="if(event.key === 'Enter') document.getElementById('sendButton').click()"
                    >

                    <button id="sendButton" class="chat-icon-button p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full h-10 w-10 flex items-center justify-center shadow-md disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-paper-plane text-lg"></i>
                    </button>
                </div>
                
                <div id="chatSignInPrompt" class="p-4 text-center bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-300 font-medium cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700" style="display: none;">
                    Tap here to set your name and start chatting!
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-gray-800 dark:bg-gray-950 text-white p-6 mt-12 shadow-inner transition-colors duration-500">
        <div class="container mx-auto text-center">
            <p class="text-sm font-light">
                Elite League | Public View. Built to be fully responsive.
            </p>
        </div>
    </footer>


<script>
    // --- LOCAL STORAGE KEY DEFINITIONS (Must match Admin Dashboard) ---
    const STORAGE_KEYS = {
        STANDINGS: 'eliteLeagueStandings',
        SCORERS: 'eliteLeagueScorers',
        ASSISTS: 'eliteLeagueAssists',
        NEWS: 'eliteLeagueNews',
        PLAYERS: 'eliteLeaguePlayers'
    };
    
    // --- ELITE LEAGUE TEAMS ---
    const TEAM_NAMES = [
        'CSC 100', 'CSC 200', 'CSC 300', 'CSC 400', 
        'MSS 100', 'MSS 200', 'MSS 300', 'MSS 400', 
        'LAW 100', 'LAW 200', 'LAW 300', 'LAW 400', 'LAW 500'
    ];

    // Initial Team Structure for fallback
    const INITIAL_STANDINGS = TEAM_NAMES.map(name => ({
        id: name.replace(/\s/g, '').toLowerCase(),
        name: name,
        P: 0, W: 0, D: 0, L: 0, Pts: 0 
    }));

    // --- DATA HANDLING UTILITIES ---

    function loadData(key, fallbackData) {
        const data = localStorage.getItem(key);
        if (data) {
            try { return JSON.parse(data); } catch (e) { return fallbackData; }
        }
        return fallbackData;
    }

    // Load all necessary data
    let standings = loadData(STORAGE_KEYS.STANDINGS, INITIAL_STANDINGS);
    let scorers = loadData(STORAGE_KEYS.SCORERS, []);
    let assists = loadData(STORAGE_KEYS.ASSISTS, []);
    let newsList = loadData(STORAGE_KEYS.NEWS, []);
    let registeredPlayers = loadData(STORAGE_KEYS.PLAYERS, []);
    

    // --- LEAGUE TABLE RENDERING ---

    function sortStandings(data) {
        return data.sort((a, b) => {
            if (b.Pts !== a.Pts) return b.Pts - a.Pts;
            if (b.W !== a.W) return b.W - a.W;
            return a.name.localeCompare(b.name);
        });
    }

    function renderLeagueTable() {
        standings = loadData(STORAGE_KEYS.STANDINGS, INITIAL_STANDINGS);
        const tableBody = document.getElementById('leagueTableBody');
        const sortedStandings = sortStandings(standings);
        
        tableBody.innerHTML = ''; 

        if (sortedStandings.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="7" class="py-4 text-center text-gray-500 dark:text-gray-400">No teams registered yet.</td></tr>`;
            return;
        }
        
        sortedStandings.forEach((team, index) => {
            const row = document.createElement('tr');
            let rowClass = index < 2 ? 'bg-blue-50 dark:bg-gray-700/50' : 'bg-white dark:bg-gray-800';
            
            row.className = rowClass;
            
            row.innerHTML = `
                <td class="px-3 py-3 whitespace-nowrap text-sm font-bold text-gray-900 dark:text-gray-100">${index + 1}</td>
                <td class="px-6 py-3 whitespace-nowrap text-sm font-semibold text-blue-600 dark:text-blue-400">${team.name}</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300 text-center">${team.P}</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300 text-center">${team.W}</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300 text-center">${team.D}</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300 text-center">${team.L}</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm font-extrabold text-blue-600 dark:text-blue-400 text-center">${team.Pts}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    // --- SCORERS/ASSISTS RENDERING UTILITY ---

    function renderLeaderboard(key, listId, statName, iconClass, countProperty, rankColor) {
        let data = loadData(key, []);
        const listContainer = document.getElementById(listId);
        listContainer.innerHTML = '';
        
        const sortedData = data.sort((a, b) => {
            if (b[countProperty] !== a[countProperty]) return b[countProperty] - a[countProperty];
            return a.name.localeCompare(b.name);
        }).slice(0, 20);

        if (sortedData.length === 0 || sortedData.every(p => p[countProperty] === 0)) {
            listContainer.innerHTML = `<p class="text-gray-400 text-center italic">No ${statName} recorded yet.</p>`;
            return;
        }

        sortedData.forEach((player, index) => {
            if (player[countProperty] === 0) return;
            
            const card = document.createElement('div');
            card.className = 'p-3 bg-gray-700/50 rounded-lg shadow flex justify-between items-center text-white border-l-4 border-blue-700/70';
            
            let rankNumClass = 'text-gray-400';
            if (index === 0) rankNumClass = 'text-yellow-400 text-lg font-black';
            else if (index === 1) rankNumClass = 'text-gray-300 font-bold';
            else if (index === 2) rankNumClass = 'text-yellow-600 font-semibold';
            else rankNumClass = 'text-gray-400 font-medium';

            card.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="${rankNumClass} w-6 text-right">${index + 1}.</span>
                    <span class="font-semibold text-base">${player.name}</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-xl font-extrabold ${rankColor}">${player[countProperty]}</span>
                    <i class="${iconClass} ${rankColor}"></i>
                </div>
            `;
            listContainer.appendChild(card);
        });
    }

    function renderTopScorers() {
        renderLeaderboard(
            STORAGE_KEYS.SCORERS, 
            'scorersList', 
            'goals', 
            'fas fa-futbol text-blue-500', 
            'goals', 
            'text-blue-500'
        );
    }

    function renderTopAssists() {
        renderLeaderboard(
            STORAGE_KEYS.ASSISTS, 
            'assistsList', 
            'assists', 
            'fas fa-chart-line text-green-400', 
            'assists', 
            'text-green-400'
        );
    }

    // --- NEWS RENDERING ---
    
    function renderNewsList() {
        newsList = loadData(STORAGE_KEYS.NEWS, []);

        const newsContainer = document.getElementById('newsContainer');
        const staticNewsHTML = newsContainer.innerHTML; 
        newsContainer.innerHTML = ''; 

        if (newsList.length > 0) {
            [...newsList].reverse().slice(0, 3).forEach(newsItem => {
                const newsCard = document.createElement('div');
                newsCard.className = 'bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md news-item transition duration-300 hover:shadow-lg hover:border-blue-700 dark:hover:border-blue-300';
                newsCard.innerHTML = `
                    <p class="text-sm font-semibold text-blue-600 dark:text-blue-400">ADMIN UPDATE</p>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mt-1">${newsItem.title}</h3>
                    <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">${newsItem.content}</p>
                    <span class="text-xs text-gray-500 dark:text-gray-400 mt-2 block">${new Date(newsItem.timestamp).toLocaleDateString()}</span>
                `;
                newsContainer.appendChild(newsCard);
            });
        }
        
        newsContainer.insertAdjacentHTML('beforeend', staticNewsHTML);
    }
    
    
    // --- LEAGUE ROSTER RENDERING ---
    
    function renderLeagueRoster() {
        registeredPlayers = loadData(STORAGE_KEYS.PLAYERS, []);
        
        const rosterList = document.getElementById('rosterList');
        rosterList.innerHTML = '';
        
        const assignedPlayers = registeredPlayers.filter(p => p.teamId);
        
        const teamsMap = standings.reduce((acc, team) => {
            acc[team.id] = { name: team.name, players: [] };
            return acc;
        }, {});
        
        assignedPlayers.forEach(player => {
            if (teamsMap[player.teamId]) {
                teamsMap[player.teamId].players.push(player.name);
            }
        });
        
        let hasTeamsOrPlayers = false;
        Object.values(teamsMap).forEach(team => {
            if (team.players.length > 0 || standings.length > 0) {
                hasTeamsOrPlayers = true;
                const teamDiv = document.createElement('div');
                teamDiv.className = 'p-3 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm';
                teamDiv.innerHTML = `
                    <h4 class="font-bold text-blue-600 dark:text-blue-400">${team.name} (${team.players.length} Players)</h4>
                    <ul class="list-disc ml-5 mt-1 space-y-0.5 text-gray-700 dark:text-gray-300">
                        ${team.players.length > 0 ? team.players.map(p => `<li>${p}</li>`).join('') : '<li class="text-gray-500 dark:text-gray-400 italic">No players assigned yet.</li>'}
                    </ul>
                `;
                rosterList.appendChild(teamDiv);
            }
        });
        
        if (!hasTeamsOrPlayers) {
            rosterList.innerHTML = `<p class="font-semibold text-gray-500 dark:text-gray-400">No teams or players registered yet.</p>`;
        }
    }
    
    // --- CHAT SIMULATION LOGIC ---
    
    const CHAT_KEY = 'eliteChatUsername';
    let currentUsername = localStorage.getItem(CHAT_KEY);
    const chatMessagesContainer = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    function checkUsername() {
        const modal = document.getElementById('usernameModal');
        const inputArea = document.getElementById('chatInputArea');
        const signInPrompt = document.getElementById('chatSignInPrompt');
        const userIdDisplay = document.getElementById('chatUserIdDisplay');
        const authIndicator = document.getElementById('authStatusIndicator');

        if (currentUsername) {
            modal.classList.add('hidden');
            inputArea.classList.remove('hidden');
            signInPrompt.style.display = 'none';
            userIdDisplay.textContent = `Logged in as: ${currentUsername}`;
            authIndicator.textContent = 'Signed In';
            sendButton.disabled = false;
        } else {
            inputArea.classList.add('hidden');
            signInPrompt.style.display = 'block';
            userIdDisplay.textContent = 'Anonymous';
            authIndicator.textContent = 'Sign In to Chat';
            sendButton.disabled = true;
            signInPrompt.onclick = () => {
                modal.classList.remove('hidden');
            };
        }
        document.getElementById('chatLoadingMessage').style.display = 'none';
    }

    function saveUsername() {
        const nameInput = document.getElementById('chatUserNameInput');
        const name = nameInput.value.trim();

        if (name.length > 2) {
            currentUsername = name;
            localStorage.setItem(CHAT_KEY, currentUsername);
            checkUsername();
        } else {
            alert('Please enter a valid username (at least 3 characters).');
        }
    }

    function sendMessage() {
        const messageText = messageInput.value.trim();
        if (!messageText || !currentUsername) return;

        displayMessage(currentUsername, messageText, 'self');

        messageInput.value = '';
        sendButton.disabled = true;

        setTimeout(() => {
            simulateResponse(messageText);
        }, 1500);
        
        setTimeout(() => {
             sendButton.disabled = false;
             messageInput.focus();
        }, 500);
    }
    
    function simulateResponse(originalMessage) {
        const names = ['LAW 500 Captain', 'CSC Fan', 'Elite Admin', 'MSS Observer'];
        const responses = [
            `I agree, ${currentUsername}! That LAW 100 team looks strong.`,
            `Stats are looking very competitive!`,
            `I hear a big upset is coming in the next fixture!`,
            `The blue theme is sharp!`,
            `Loud and clear on that point.`
        ];
        
        const randomName = names[Math.floor(Math.random() * names.length)];
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        
        displayMessage(randomName, randomResponse, 'other');
    }

    function displayMessage(user, text, type) {
        const messageElement = document.createElement('div');
        messageElement.className = 'flex';
        
        let bubbleClass = '';
        let containerClass = '';
        let nameColor = '';
        let userText = user;

        if (type === 'self') {
            containerClass = 'justify-end';
            bubbleClass = 'bg-blue-500 text-white rounded-tr-none';
            nameColor = 'text-blue-300';
            userText = 'You';
        } else if (type === 'system') {
            containerClass = 'justify-center';
            bubbleClass = 'bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-200 text-center text-xs italic max-w-sm';
            nameColor = 'hidden';
            userText = '';
        } 
        else {
            containerClass = 'justify-start';
            bubbleClass = 'bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-tl-none';
            nameColor = 'text-gray-500 dark:text-gray-400';
        }
        
        if (type === 'system') {
            messageElement.innerHTML = `<div class="${containerClass} w-full my-1"><div class="${bubbleClass} px-3 py-1 rounded-full shadow-sm">${text}</div></div>`;
        } else {
            messageElement.className = `flex ${containerClass}`;
            messageElement.innerHTML = `
                <div class="message-bubble px-4 py-2 ${bubbleClass} rounded-xl shadow-md space-y-1">
                    <p class="text-xs font-semibold ${nameColor}">${userText}</p>
                    <p class="text-sm">${text}</p>
                </div>
            `;
        }
        
        chatMessagesContainer.appendChild(messageElement);
        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
    }
    
    function simulateFeature(featureName) {
        if (!currentUsername) {
            document.getElementById('usernameModal').classList.remove('hidden');
            return;
        }
        displayMessage('SYSTEM', `${currentUsername} attempted to send a ${featureName}. This is a simulated feature.`, 'system');
    }
    

    // --- INITIALIZATION ---

    function initializePublicDashboard() {
        renderLeagueTable();
        renderTopScorers();
        renderTopAssists();
        renderNewsList();
        renderLeagueRoster(); 
        checkUsername();

        document.getElementById('saveUserNameButton').addEventListener('click', saveUsername);
        document.getElementById('sendButton').addEventListener('click', sendMessage);
        document.getElementById('vnButton').addEventListener('click', () => simulateFeature('Voice Note'));
        document.getElementById('stickerButton').addEventListener('click', () => simulateFeature('Sticker'));
        
         setTimeout(() => {
             if (!currentUsername) {
                displayMessage('SYSTEM', 'Welcome to the Elite League Live Chat! Sign in below to join the conversation.', 'system');
             } else {
                displayMessage('SYSTEM', `Welcome back, ${currentUsername}!`, 'system');
             }
         }, 500);
    }

    document.addEventListener('DOMContentLoaded', initializePublicDashboard);
</script>

</body>
</html>