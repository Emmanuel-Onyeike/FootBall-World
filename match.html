<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Match Simulator | Player Setup</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(circle at center, #0b0b0b 0%, #000 100%);
    }
    .glass {
      background: rgba(20, 20, 20, 0.8);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 255, 120, 0.2);
    }
  </style>
</head>

<body class="text-white min-h-screen p-4 md:p-8 flex flex-col items-center justify-center">
  <!-- Container -->
  <div id="playerSetup" class="glass max-w-5xl w-full mx-auto rounded-2xl shadow-2xl p-6 md:p-10 border border-green-700/40">
    <h1 class="text-3xl md:text-4xl font-bold text-green-400 text-center mb-8">⚽ Player Ability Setup</h1>

    <p class="text-center text-gray-400 mb-6">Assign 3 abilities and positions to each player before match simulation.</p>

    <div id="teamPlayersContainer" class="space-y-10"></div>

    <div class="flex justify-center mt-10">
      <button 
        id="startMatch"
        class="bg-green-600 hover:bg-green-500 px-8 py-3 rounded-xl font-semibold transition"
      >Kick Off Match ⚽</button>
    </div>
  </div>

  <!-- Script -->
  <script>
    // For testing/demo purpose, preload some data
    if (!localStorage.getItem('teamSetup')) {
      localStorage.setItem('teamSetup', JSON.stringify({
        teamA: "CSC 200 Level",
        teamB: "Nursing 200 Level",
        playersA: ["Kev O", "Princewill", "Marvin", "Paschal", "Zubby"],
        playersB: ["Onyema", "Emmanuel", "Austin", "Sammy", "Chris"]
      }));
    }

    const teamData = JSON.parse(localStorage.getItem('teamSetup'));
    if (!teamData) {
      document.body.innerHTML = '<p class="text-center mt-20 text-red-500 text-xl">⚠ No team data found. Please go back and set up your teams first.</p>';
    }

    const container = document.getElementById('teamPlayersContainer');
    const abilities = ['Shooting', 'Passing', 'Pace', 'Physical', 'Dribbling'];
    const positions = ['GK', 'DEF', 'MID', 'ATT'];

    // Generate team blocks
    ['A', 'B'].forEach(side => {
      const teamName = teamData[`team${side}`];
      const players = teamData[`players${side}`];

      const teamBlock = document.createElement('div');
      teamBlock.innerHTML = `
        <h3 class="text-2xl font-bold text-green-400 mb-4">${teamName}</h3>
        <div class="grid gap-4">
          ${players.map(player => `
            <div class="bg-[#1a1a1a] rounded-xl p-4 border border-gray-700">
              <h4 class="font-semibold mb-3 text-lg">${player}</h4>

              <div class="flex flex-wrap gap-3 mb-3">
                ${abilities.map(ab => `
                  <label class="flex items-center gap-2 text-sm">
                    <input type="checkbox" name="${teamName}-${player}-abilities" value="${ab}" class="accent-green-600 ability-checkbox">
                    <span>${ab}</span>
                  </label>
                `).join('')}
              </div>

              <select name="${teamName}-${player}-position" 
                class="bg-[#111] border border-gray-600 rounded-lg p-2 w-full text-white focus:ring-2 focus:ring-green-500">
                <option value="">Select Position</option>
                ${positions.map(pos => `<option value="${pos}">${pos}</option>`).join('')}
              </select>
            </div>
          `).join('')}
        </div>
      `;
      container.appendChild(teamBlock);
    });

    // Limit abilities to 3 per player
    document.addEventListener('change', (e) => {
      if (e.target.classList.contains('ability-checkbox')) {
        const group = e.target.name;
        const checkboxes = document.querySelectorAll(`input[name="${group}"]`);
        const checked = [...checkboxes].filter(c => c.checked);
        if (checked.length > 3) {
          e.target.checked = false;
          alert('You can only select 3 abilities per player!');
        }
      }
    });

    // Start Match
    document.getElementById('startMatch').onclick = () => {
      const allPlayers = [];
      let allComplete = true;

      document.querySelectorAll('.bg-[#1a1a1a]').forEach(card => {
        const playerName = card.querySelector('h4').innerText;
        const selectedAbilities = [...card.querySelectorAll('.ability-checkbox:checked')].map(cb => cb.value);
        const position = card.querySelector('select').value;

        if (selectedAbilities.length !== 3 || !position) {
          alert(`Please complete setup for ${playerName}`);
          allComplete = false;
          return;
        }

        allPlayers.push({ playerName, selectedAbilities, position });
      });

      if (!allComplete) return;

      localStorage.setItem('playerSetup', JSON.stringify(allPlayers));
      window.location.href = 'match.html'; // Move to the pitch screen
    };
  </script>
</body>
</html>
