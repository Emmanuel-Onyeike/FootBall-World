<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GOLDEN FIRE MATCH PRO — 12.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --green-team: #10b981;
      --red-team: #ef4444;
      --gold: #fbbf24;
      --fire: #f97316;
      --pitch-dark: #013a2a;
      --pitch-light: #02584b;
      --danger-glow: 0 0 30px rgba(251,191,36,0.8);
      --safe-glow: 0 0 20px rgba(34,197,94,0.6);
      --ball-shadow: 0 4px 12px rgba(0,0,0,0.5), 0 0 15px rgba(251,191,36,0.4);
    }
    body { font-family: 'Inter', sans-serif; background: #000; }
    .pitch-container {
      background: radial-gradient(circle at center, #034c3c 0%, #013a2a 100%);
      border-radius: 24px; position: relative; overflow: hidden;
      box-shadow: 0 30px 70px rgba(0,0,0,0.8), inset 0 0 40px rgba(251,191,36,0.18);
      border: 3px solid rgba(251,191,36,0.35);
      width: 100%; height: 640px; max-width: 1000px; margin: 0 auto;
    }
    .pitch {
      position: relative; width: 100%; height: 100%; overflow: hidden;
    }
    .pitch-line { position: absolute; background: rgba(255,255,255,0.25); }
    .center-circle { 
      position: absolute; width: 120px; height: 120px; border: 3px solid rgba(251,191,36,0.4); 
      border-radius: 50%; left: 50%; top: 50%; transform: translate(-50%,-50%); 
    }
    .center-spot { 
      position: absolute; width: 12px; height: 12px; background: #fbbf24; border-radius: 50%; 
      left: 50%; top: 50%; transform: translate(-50%,-50%); box-shadow: 0 0 20px rgba(251,191,36,0.9);
    }
    .penalty-area { 
      position: absolute; border: 2.5px solid rgba(255,255,255,0.3); 
      background: rgba(255,255,255,0.03);
    }
    .goal-area { 
      position: absolute; border: 2.5px solid rgba(255,255,255,0.3); 
      background: rgba(255,255,255,0.05);
    }
    .goal-post {
      position: absolute; width: 8px; height: 48px; background: #fff; 
      box-shadow: 0 0 15px rgba(255,255,255,0.6); z-index: 10;
    }
    .goal-net {
      position: absolute; width: 100px; height: 50px; background: repeating-linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.1) 10px, transparent 10px, transparent 20px);
      border: 2px solid rgba(255,255,255,0.3); z-index: 5; opacity: 0.6;
    }
    .player-pill {
      min-width: 68px; height: 44px; text-align: center; 
      box-shadow: 0 10px 28px rgba(0,0,0,0.7), 0 0 18px rgba(251,191,36,0.35);
      transition: all .24s cubic-bezier(.4,0,.2,1); z-index: 30; cursor: grab; font-weight: 700;
      display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 9999px;
      backdrop-filter: blur(8px); border: 2.5px solid;
      font-size: 0.78rem; letter-spacing: 0.6px; padding: 0 6px;
    }
    .player-pill:active { cursor: grabbing; transform: scale(1.18); }
    .player-pill.team-a { 
      background: linear-gradient(135deg, rgba(16,185,129,0.3), rgba(5,150,105,0.2)); 
      border-color: rgba(16,185,129,0.65); color: #d1fae5; 
    }
    .player-pill.team-b { 
      background: linear-gradient(135deg, rgba(239,68,68,0.3), rgba(220,38,38,0.2)); 
      border-color: rgba(239,68,68,0.65); color: #fecaca; 
    }
    .player-pill.danger {
      animation: dangerPulse 1.3s infinite;
      box-shadow: var(--danger-glow), 0 0 20px rgba(249,115,22,0.9) !important;
      border-color: #fbbf24 !important;
    }
    .player-pill.safe {
      animation: safePulse 1.7s infinite;
      box-shadow: var(--safe-glow), 0 0 15px rgba(16,185,129,0.7) !important;
      border-color: #10b981 !important;
    }
    @keyframes dangerPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.22); }
    }
    @keyframes safePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .ball {
      width: 28px; height: 28px; 
      background: radial-gradient(circle at 38% 38%, #fff, #e5e7eb 60%, #bbb 100%);
      box-shadow: var(--ball-shadow); z-index: 25; 
      transition: all .3s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid #fbbf24;
      border-radius: 50%; position: absolute;
    }
    .ball.danger { animation: ballDanger 0.9s infinite; }
    @keyframes ballDanger { 0%,100% { box-shadow: var(--ball-shadow), 0 0 25px #f97316; } 50% { box-shadow: var(--ball-shadow), 0 0 40px #f97316; } }
    .pass-line {
      position: absolute; height: 2px; background: rgba(251,191,36,0.7); 
      transform-origin: left center; z-index: 15; opacity: 0;
      box-shadow: 0 0 12px rgba(251,191,36,0.6);
    }
    .pass-line.show { animation: passAnim 0.6s ease-out forwards; }
    @keyframes passAnim {
      0% { opacity: 1; transform: scaleX(0); }
      70% { opacity: 1; transform: scaleX(1.1); }
      100% { opacity: 0; transform: scaleX(1); }
    }
    .goal-flash { 
      animation: goalPulse 0.8s ease-out forwards; position: absolute; top: 16px; left: 50%; transform: translateX(-50%);
      background: linear-gradient(90deg, rgba(251,191,36,0.35), rgba(34,197,94,0.35)); 
      color: #fbbf24; padding: 14px 32px; border-radius: 14px; font-weight: 800; font-size: 1.2rem;
      box-shadow: 0 0 50px rgba(251,191,36,0.7), 0 0 25px rgba(34,197,94,0.6); 
      backdrop-filter: blur(10px); border: 2px solid rgba(251,191,36,0.5);
      text-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }
    @keyframes goalPulse {
      0% { transform: translateX(-50%) scale(0.6); opacity: 0; }
      40% { transform: translateX(-50%) scale(1.4); }
      100% { transform: translateX(-50%) scale(1); opacity: 1; }
    }
    .loading-overlay { backdrop-filter: blur(14px); background: rgba(0,0,0,0.94); }
    .team-card { transition: all .28s; }
    .team-card:hover { transform: translateY(-4px); box-shadow: 0 18px 35px rgba(251,191,36,0.18); }
    .possession-bar { height: 10px; border-radius: 5px; overflow: hidden; background: #1f2937; border: 1px solid #374151; }
    .possession-fill { height: 100%; transition: width .8s ease; }
    .possession-fill.a { background: linear-gradient(90deg, #10b981, #34d399); }
    .possession-fill.b { background: linear-gradient(90deg, #ef4444, #fca5a5); }
    .btn-primary { 
      background: linear-gradient(135deg, #f59e0b, #f97316); color: white; font-weight: 700; 
      box-shadow: 0 8px 18px rgba(249,115,22,0.45);
    }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 24px rgba(249,115,22,0.55); }
    .btn-secondary { background: #374151; }
    .btn-secondary:hover { background: #4b5563; }
    .commentary-line { font-size: 14px; line-height: 1.7; }
    .commentary-line .time { color: #94a3b8; font-family: monospace; font-weight: 600; }
    .score-line {
      font-weight: 900; font-size: 3.6rem; letter-spacing: -3px;
      background: linear-gradient(90deg, #10b981, #fbbf24, #ef4444);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 4px 12px rgba(0,0,0,0.5);
      transition: all .38s ease;
    }
    .score-line.goal { animation: scorePulse 0.75s ease-out; }
    @keyframes scorePulse {
      0% { transform: scale(1); }
      45% { transform: scale(1.38); }
      100% { transform: scale(1); }
    }
    .commentary-line.live {
      color: #fbbf24; font-weight: 700; animation: liveBlink 1.5s infinite;
      text-shadow: 0 0 12px rgba(251,191,36,0.6);
    }
    @keyframes liveBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.78; }
    }
    .arrow-indicator {
      position: absolute; font-size: 2rem; color: #fbbf24; z-index: 28; opacity: 0;
      transition: opacity .32s; text-shadow: 0 0 18px rgba(251,191,36,0.9);
      animation: arrowPulse 1.1s infinite;
    }
    .arrow-indicator.show { opacity: 1; }
    @keyframes arrowPulse {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-slate-100 min-h-screen">

  <div class="container mx-auto p-4 md:p-6 max-w-7xl">
    <!-- Header -->
    <header class="mb-8 text-center">
      <h1 class="text-5xl md:text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 via-amber-400 to-rose-500">
        <i class="fas fa-futbol mr-3 animate-pulse"></i> GOLDEN FIRE MATCH PRO
      </h1>
      <p class="text-slate-300 mt-3 text-base md:text-lg font-medium">
        <i class="fas fa-bolt mr-2 text-amber-400"></i> Real Football • Moving Ball • Player Flow • Goalposts
      </p>
    </header>

    <main class="grid lg:grid-cols-12 gap-6">
      <!-- Team A Panel -->
      <section class="lg:col-span-3">
        <div class="bg-slate-900/85 backdrop-blur-2xl p-6 rounded-2xl border border-amber-500/30 shadow-2xl team-card">
          <div class="flex items-center justify-between mb-5">
            <input id="teamAName" class="flex-1 bg-transparent border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-amber-500 focus:outline-none transition" 
                   placeholder="Team A name" value="Real Team A"/>
            <button id="tickA" class="ml-3 px-5 py-2.5 rounded-lg bg-gradient-to-r from-amber-600 to-amber-700 text-white font-bold text-sm hover:from-amber-700 hover:to-amber-800 transition shadow-lg">
              <i class="fas fa-robot mr-1"></i> AI
            </button>
          </div>
          <h3 id="teamATitle" class="text-2xl font-bold text-emerald-400 mb-4 flex items-center">
            <i class="fas fa-shield-alt mr-2"></i> Real Team A
          </h3>
          <div id="players-A" class="space-y-2.5 max-h-96 overflow-y-auto pr-1"></div>
        </div>
      </section>

      <!-- Center: Pitch + Controls -->
      <section class="lg:col-span-6">
        <div class="bg-slate-900/85 backdrop-blur-2xl p-6 rounded-2xl border border-amber-500/30 shadow-2xl">
          <!-- Controls -->
          <div class="flex flex-wrap gap-3 mb-6">
            <button id="startFlowBtn" class="flex-1 md:flex-initial px-7 py-3.5 rounded-xl btn-primary text-white font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
              <i class="fas fa-play mr-2"></i> IGNITE MATCH
            </button>
            <button id="pauseBtn" class="px-6 py-3.5 rounded-xl btn-secondary text-white font-bold shadow-md">
              <i class="fas fa-pause"></i> Pause
            </button>
            <button id="ffBtn" class="px-6 py-3.5 rounded-xl btn-secondary text-white font-bold shadow-md">
              <i class="fas fa-forward"></i> +6'
            </button>
          </div>

          <!-- Score & Time -->
          <div class="bg-gradient-to-r from-slate-800/80 to-slate-900/80 backdrop-blur p-5 rounded-xl mb-6 border border-amber-500/20 shadow-xl">
            <div class="grid grid-cols-3 items-center text-center">
              <div>
                <div id="modalTeamA" class="text-xl font-bold text-emerald-400 flex items-center justify-center">
                  <i class="fas fa-flag mr-2"></i> Real Team A
                </div>
                <div id="modalTeamAName" class="text-xs text-slate-300 mt-1">Real Team A</div>
              </div>
              <div>
                <div class="flex items-center justify-center gap-4">
                  <div id="scoreA" class="score-line">0</div>
                  <div class="text-4xl font-bold text-amber-400">—</div>
                  <div id="scoreB" class="score-line">0</div>
                </div>
                <div id="matchTime" class="text-2xl font-mono text-amber-400 mt-2 font-bold">0'</div>
                <div class="possession-bar mt-3">
                  <div id="possessionFillA" class="possession-fill a" style="width:50%"></div>
                </div>
                <div id="possessionInfo" class="text-sm text-slate-300 mt-2 font-medium">Possession — 50% · 50%</div>
              </div>
              <div>
                <div id="modalTeamB" class="text-xl font-bold text-rose-400 flex items-center justify-center">
                  <i class="fas fa-flag mr-2"></i> Real Team B
                </div>
                <div id="modalTeamBName" class="text-xs text-slate-300 mt-1">Real Team B</div>
              </div>
            </div>
          </div>

          <!-- SPACIOUS PITCH -->
          <div class="pitch-container relative">
            <div class="pitch" id="pitch">
              <!-- Pitch Lines -->
              <div class="pitch-line" style="left:0;right:0;top:50%;height:2px;"></div>
              <div class="pitch-line" style="left:50%;top:0;bottom:0;width:2px;"></div>
              <div class="center-circle"></div>
              <div class="center-spot"></div>

              <!-- Penalty Areas -->
              <div class="penalty-area" style="left:5%;top:20%;width:25%;height:60%;"></div>
              <div class="penalty-area" style="right:5%;top:20%;width:25%;height:60%;"></div>
              <div class="goal-area" style="left:12%;top:35%;width:12%;height:30%;"></div>
              <div class="goal-area" style="right:12%;top:35%;width:12%;height:30%;"></div>

              <!-- Goalposts & Nets -->
              <div class="goal-post" style="left:1.5%;top:42%;"></div>
              <div class="goal-post" style="left:3.5%;top:42%;"></div>
              <div class="goal-net" style="left:-2%;top:40%;"></div>

              <div class="goal-post" style="right:1.5%;top:42%;"></div>
              <div class="goal-post" style="right:3.5%;top:42%;"></div>
              <div class="goal-net" style="right:-2%;top:40%;"></div>

              <!-- Ball -->
              <div id="ball" class="ball" style="left:50%;top:50%;transform:translate(-50%,-50%)"></div>

              <!-- Pass Line -->
              <div id="passLine" class="pass-line"></div>

              <!-- Goal Flash -->
              <div id="goalFlashHolder" class="absolute top-4 left-1/2 -translate-x-1/2"></div>

              <!-- Arrow Indicator -->
              <div id="arrowIndicator" class="arrow-indicator">Down Arrow</div>
            </div>
          </div>

          <!-- Stats -->
          <div class="grid grid-cols-3 gap-4 mt-6 text-center">
            <div class="bg-gradient-to-b from-slate-800/70 to-slate-900/70 p-4 rounded-lg border border-amber-500/20 backdrop-blur">
              <div class="text-sm text-slate-300 font-medium">Fouls</div>
              <div class="text-2xl font-bold text-amber-400"><span id="mA-fouls">0</span> · <span id="mB-fouls">0</span></div>
            </div>
            <div class="bg-gradient-to-b from-slate-800/70 to-slate-900/70 p-4 rounded-lg border border-amber-500/20 backdrop-blur">
              <div class="text-sm text-slate-300 font-medium">Yellow</div>
              <div class="text-2xl font-bold text-amber-400"><span id="mA-y">0</span> · <span id="mB-y">0</span></div>
            </div>
            <div class="bg-gradient-to-b from-slate-800/70 to-slate-900/70 p-4 rounded-lg border border-amber-500/20 backdrop-blur">
              <div class="text-sm text-slate-300 font-medium">Red</div>
              <div class="text-2xl font-bold text-amber-400"><span id="mA-r">0</span> · <span id="mB-r">0</span></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Team B + Events -->
      <section class="lg:col-span-3">
        <div class="bg-slate-900/85 backdrop-blur-2xl p-6 rounded-2xl border border-amber-500/30 shadow-2xl team-card">
          <div class="flex items-center justify-between mb-5">
            <input id="teamBName" class="flex-1 bg-transparent border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-amber-500 focus:outline-none transition" 
                   placeholder="Team B name" value="Real Team B"/>
            <button id="tickB" class="ml-3 px-5 py-2.5 rounded-lg bg-gradient-to-r from-amber-600 to-amber-700 text-white font-bold text-sm hover:from-amber-700 hover:to-amber-800 transition shadow-lg">
              <i class="fas fa-robot mr-1"></i> AI
            </button>
          </div>
          <h3 id="teamBTitle" class="text-2xl font-bold text-rose-400 mb-4 flex items-center">
            <i class="fas fa-shield-alt mr-2"></i> Real Team B
          </h3>
          <div id="players-B" class="space-y-2.5 max-h-64 overflow-y-auto pr-1 mb-6"></div>

          <div class="text-sm font-bold text-amber-400 mb-3 flex items-center">
            <i class="fas fa-list-ul mr-2"></i> LIVE EVENT LOG
          </div>
          <div id="eventLog" class="bg-slate-800/60 p-4 rounded-lg h-64 overflow-y-auto text-sm font-mono border border-amber-500/20 backdrop-blur"></div>
        </div>
      </section>
    </main>

    <!-- Commentary -->
    <section class="mt-8 bg-gradient-to-r from-slate-900/90 to-slate-950/90 backdrop-blur-2xl p-6 rounded-2xl border border-amber-500/30 shadow-2xl">
      <div class="flex items-center justify-between mb-5">
        <h4 class="text-2xl font-bold flex items-center text-amber-400">
          <i class="fas fa-microphone mr-3 animate-pulse"></i> LIVE GOLDEN COMMENTARY
        </h4>
        <div class="text-sm text-slate-300">Real-time play-by-play</div>
      </div>
      <div id="modalCommentary" class="h-56 overflow-y-auto pr-3 space-y-1.5 commentary-line text-sm"></div>
    </section>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 z-50 flex items-center justify-center loading-overlay">
      <div class="bg-slate-900/98 p-10 rounded-3xl text-center border-2 border-amber-500/50 shadow-2xl">
        <div class="w-20 h-20 border-5 border-amber-500 border-t-transparent rounded-full animate-spin mx-auto mb-5"></div>
        <div id="loadingText" class="text-2xl font-bold text-amber-400">IGNITING THE PITCH…</div>
        <div id="countdown" class="text-5xl font-bold text-white mt-4">5</div>
      </div>
    </div>
  </div>

<script>
// ==============================
// CONFIG & DATA
// ==============================
const starterCount = 11, subsCount = 4;
const abilitiesList = ['Shooting','Passing','Pace','Physical','Dribbling'];
const proPool = ["C. Ronaldo","L. Messi","K. Mbappé","E. Haaland","K. De Bruyne","Neymar Jr","V. Jr.","M. Salah","K. Benzema","R. Lewandowski","H. Kane","B. Silva","J. Kimmich","T. Müller","P. Foden","J. Grealish","R. Sterling","F. Valverde","B. Fernandes","Casemiro","Virgil van Dijk","T. Alexander-Arnold","Rúben Dias","João Cancelo","A. Robertson","Sergio Ramos","Thiago Silva","Marquinhos","E. Martínez","M. ter Stegen","G. Donnarumma","A. Becker","Ederson","K. Trippier","Pedri","Gavi","Rodri","T. Kroos","L. Modrić","J. Bellingham","M. Ødegaard","N. Kanté","B. Guimarães","Declan Rice","Enzo Fernández","Marco Reus","Ilkay Gündoğan","Paulo Dybala","Phil Foden","Jack Grealish","João Félix","Gabriel Jesus","Rashford","Sancho","Dembele","Lautaro Martínez","O. Giroud","Antony","Luis Díaz","Darwin Núñez","Federico Chiesa","R. Leão","Ansu Fati","T. Werner","S. Mané","Luka Jović","Angel Di María","Paul Pogba","Memphis Depay","Christian Eriksen","Z. Ibrahimović","Coutinho","Mesut Özil","Eden Hazard","Bale","Busquets","Chiellini","Bonucci"];

// ==============================
// ELEMENTS
// ==============================
const pitchEl = document.getElementById('pitch');
const ballEl = document.getElementById('ball');
const passLine = document.getElementById('passLine');
const goalFlashHolder = document.getElementById('goalFlashHolder');
const arrowIndicator = document.getElementById('arrowIndicator');
let currentBallHolder = null;
let currentDangerPlayer = null;

// ==============================
// STATE
// ==============================
let state = {
  A: { name: 'Team A', players: [], counters: { fouls:0,y:0,r:0 } },
  B: { name: 'Team B', players: [], counters: { fouls:0,y:0,r:0 } },
  sim: { running:false, minute:0, total:90, extra:5, scoreA:0, scoreB:0, possessionA:50, interval: null }
};

// ==============================
// HELPERS
// ==============================
function randPick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }
function wait(ms){ return new Promise(res=>setTimeout(res, ms)); }

// ==============================
// PLAYER & BALL MOVEMENT
// ==============================
function movePlayerTo(el, x, y, duration = 600) {
  el.style.transition = `all ${duration}ms cubic-bezier(0.4, 0, 0.2, 1)`;
  el.style.left = x + '%';
  el.style.top = y + '%';
}

function moveBallTo(x, y, duration = 500) {
  ballEl.style.transition = `all ${duration}ms cubic-bezier(0.4, 0, 0.2, 1)`;
  ballEl.style.left = x + '%';
  ballEl.style.top = y + '%';
}

function drawPassLine(fromX, fromY, toX, toY) {
  const dx = toX - fromX;
  const dy = toY - fromY;
  const length = Math.sqrt(dx*dx + dy*dy);
  const angle = Math.atan2(dy, dx) * 180 / Math.PI;

  passLine.style.width = length + '%';
  passLine.style.left = fromX + '%';
  passLine.style.top = fromY + '%';
  passLine.style.transform = `rotate(${angle}deg)`;
  passLine.classList.remove('show');
  void passLine.offsetWidth;
  passLine.classList.add('show');
}

async function passBall(fromPlayerEl, toPlayerEl) {
  const fromRect = fromPlayerEl.getBoundingClientRect();
  const toRect = toPlayerEl.getBoundingClientRect();
  const pitchRect = pitchEl.getBoundingClientRect();

  const fromX = ((fromRect.left + fromRect.width/2) - pitchRect.left) / pitchRect.width * 100;
  const fromY = ((fromRect.top + fromRect.height/2) - pitchRect.top) / pitchRect.height * 100;
  const toX = ((toRect.left + toRect.width/2) - pitchRect.left) / pitchRect.width * 100;
  const toY = ((toRect.top + toRect.height/2) - pitchRect.top) / pitchRect.height * 100;

  drawPassLine(fromX, fromY, toX, toY);
  moveBallTo(toX, toY, 550);

  currentBallHolder = toPlayerEl;
  await wait(600);
}

// ==============================
// PITCH & FORMATIONS
// ==============================
function drawPitchPlayers(){
  pitchEl.innerHTML = '';
  const layoutA = formationPositions('A');
  const layoutB = formationPositions('B');

  state.A.players.slice(0, starterCount).forEach((p,i)=>{
    if (p.sentOff) return;
    const el = createPlayerPill(p.name, 'A', i, layoutA[i]);
    pitchEl.appendChild(el);
  });
  state.B.players.slice(0, starterCount).forEach((p,i)=>{
    if (p.sentOff) return;
    const el = createPlayerPill(p.name, 'B', i, layoutB[i]);
    pitchEl.appendChild(el);
  });

  setBallPosition(50, 50);
  currentBallHolder = null;
}

function formationPositions(team){
  const baseX = team === 'A' ? 15 : 85;
  const pos = [];
  // GK
  pos.push({ x: baseX, y: 50 });
  // DEF
  for (let i = 0; i < 4; i++) pos.push({ x: baseX + (team==='A'?1:-1)*(15 + i*12), y: 70 });
  // MID
  for (let i = 0; i < 4; i++) pos.push({ x: baseX + (team==='A'?1:-1)*(10 + i*14), y: 45 });
  // ATT
  pos.push({ x: baseX + (team==='A'?1:-1)*25, y: 25 });
  pos.push({ x: baseX + (team==='A'?1:-1)*35, y: 25 });
  return pos;
}

function createPlayerPill(name, team, idx, pos){
  const el = document.createElement('div');
  el.className = `player-pill team-${team} absolute flex flex-col items-center justify-center text-xs font-semibold px-3 py-1 rounded-full gap-0.5`;
  el.dataset.team = team; el.dataset.idx = idx;
  el.style.left = pos.x + '%';
  el.style.top = pos.y + '%';
  el.style.transform = 'translate(-50%,-50%)';
  const short = name.split(' ')[0];
  el.innerHTML = `<div class="text-[10px] opacity-70">${team==='A'?'A':'B'}${idx+1}</div><div>${short}</div>`;
  return el;
}

function setBallPosition(x, y){
  ballEl.style.left = x + '%';
  ballEl.style.top = y + '%';
  ballEl.style.transform = 'translate(-50%,-50%)';
}

// ==============================
// SIMULATION & BALL FLOW
// ==============================
async function simulationTick(minute){
  const delta = Math.floor((Math.random()*6)-3);
  state.sim.possessionA = Math.max(30, Math.min(70, state.sim.possessionA + delta));
  const pA = state.sim.possessionA, pB = 100-pA;
  document.getElementById('possessionInfo').textContent = `Possession — ${pA}% · ${pB}%`;
  document.getElementById('possessionFillA').style.width = `${pA}%`;

  // Move players dynamically
  const players = pitchEl.querySelectorAll('.player-pill');
  players.forEach(p => {
    const team = p.dataset.team;
    const baseX = team === 'A' ? 15 + (pA-50)*0.3 : 85 - (pA-50)*0.3;
    const offset = parseInt(p.dataset.idx);
    const yJitter = 30 + Math.random()*40;
    const newX = baseX + (team==='A'?1:-1)*(offset % 4 * 8);
    movePlayerTo(p, newX, yJitter, 800);
  });

  // Ball possession logic
  const attackingTeam = pA > 55 ? 'A' : (pB > 55 ? 'B' : (Math.random()<0.5?'A':'B'));
  const holderPool = [...pitchEl.querySelectorAll(`.player-pill.team-${attackingTeam}`)];
  if (!holderPool.length) return;

  let newHolder = randPick(holderPool);
  if (currentBallHolder && currentBallHolder !== newHolder && Math.random() < 0.6) {
    await passBall(currentBallHolder, newHolder);
  } else {
    const rect = newHolder.getBoundingClientRect();
    const pitchRect = pitchEl.getBoundingClientRect();
    const ballX = ((rect.left + rect.width/2) - pitchRect.left) / pitchRect.width * 100;
    const ballY = ((rect.top + rect.height/2) - pitchRect.top) / pitchRect.height * 100;
    moveBallTo(ballX, ballY, 600);
    currentBallHolder = newHolder;
  }

  // Attack resolution
  if (Math.random() < 0.18) {
    await resolveAttack(attackingTeam, minute);
  }
}

// ==============================
// REST OF LOGIC (same as before, condensed)
// ==============================
document.getElementById('startFlowBtn').addEventListener('click', async () => {
  // ... (same loading, start logic)
  drawPitchPlayers();
  state.sim.running = true;
  state.sim.interval = setInterval(() => {
    if (!state.sim.running) return;
    state.sim.minute++;
    document.getElementById('matchTime').textContent = `${state.sim.minute}'`;
    simulationTick(state.sim.minute);
  }, 900);
});

// Initialize
aiGenerateTeam('A','Real Team A');
aiGenerateTeam('B','Real Team B');

function aiGenerateTeam(teamId, displayName){
  // ... (same as before)
}
</script>
</body>
</html>
